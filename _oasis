OASISFormat: 0.4
Name:        mirage-trace-viewer
Version:     0.1
Synopsis:    Graphical viewer of Lwt trace logs
Authors:     Thomas Leonard
License:     BSD-2-clause
Plugins:     META (0.4), DevFiles (0.4)

Flag collect
  Description:        true to build mirage-trace-collect tool (requires xen-gnt.unix)
  Default:            false

Flag gtk
  Description:        true to build the GTK viewer
  Default:            true

Flag javascript
  Description:        true to build the JavaScript viewer
  Default:            true
 
if flag(javascript)
  PostBuildCommand: ./precompute.native examples/log-x86.sexp && js_of_ocaml --opt=3 +weak.js example_html.byte -I examples --file log-x86.bin -o examples/example_html.js

Library "mirage-trace-viewer"
  Path:       lib
  BuildTools: ocamlbuild
  Modules:    ITree, Render, Counter, Event, Layout, Sorted_array, Thread, View
  BuildDepends: itv-tree,sexplib,sexplib.syntax,ocplib-endian.bigstring
  
Library "mirage-trace-viewer.js"
  Path:       js
  Build$:     flag(javascript)
  BuildTools: ocamlbuild
  FindlibParent: mirage-trace-viewer
  FindlibName: js
  Modules:    Html_viewer
  BuildDepends: mirage-trace-viewer,js_of_ocaml,js_of_ocaml.syntax
  
Executable "mirage-trace-viewer"
  Path:       gtk
  Build$:     flag(gtk)
  BuildTools: ocamlbuild
  MainIs:     gtk_viewer.ml
  BuildDepends: lablgtk2,cairo2.lablgtk2,cairo2,mirage-trace-viewer
  CompiledObject: best
  
Executable "mirage-trace-viewer-precompute"
  Path:       lib
  Build$:     flag(javascript)
  BuildTools: ocamlbuild
  MainIs:     precompute.ml
  BuildDepends: mirage-trace-viewer
  CompiledObject: best

Executable "mirage-trace-collect"
  Build$:     flag(collect)
  Path:       collect
  BuildTools: ocamlbuild
  MainIs:     collect.ml
  BuildDepends: xen-gnt, xen-gnt.unix, xenstore.client, xenstore.unix, xenstore_transport.unix, threads, str
  CompiledObject: best

Executable "example_html"
  Path:	      examples
  Build$:     flag(javascript)
  BuildTools: ocamlbuild
  MainIs:     example_html.ml
  BuildDepends: mirage-trace-viewer.js
  CompiledObject: byte
